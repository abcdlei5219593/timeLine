import{u as te}from"./useTableSetting.198d7378.js";import{c as ue,d as U,e as se}from"./user.26589238.js";import{_ as ne,d as re,r,a as k,o as de,y as s,K as ce,b as D,c as ie,f as l,w as o,g as C,L as pe,j as d,l as h,M as y,I as z,z as me,A as fe,e as i,t as _e,O as ge,N as $,P as ve,Q as Ee,R as De,S as Ce,p as he,q as Fe}from"./index.4d3a0603.js";const L=g=>(he("data-v-199f74cf"),g=g(),Fe(),g),be={class:"main-content"},Ne=L(()=>i("span",{class:"search-label"},"\u641C\u7D22\uFF1A",-1)),ke={class:"dialog"},ye={slot:"footer",class:"dialog-footer"},ze={class:"root-dialog dialog-content"},xe={class:"root-title"},Ie=L(()=>i("p",{class:"root-btn"},"\u6743\u9650\u8D44\u6E90",-1)),we={slot:"footer",class:"dialog-footer"},Ve=re({__name:"auth",setup(g){const x=r([]),p=r(!1),I=r(0),v=r(!1),f=r(!1),w=r(""),P={label:"label"},n=k({roleName:"",pageNum:1,pageSize:20}),t=k({roleName:"",roleDesc:""}),V=r([]),j=k({roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",trigger:"blur"}]}),m=async()=>{try{const e=await ue(n);x.value=e.list,n.pageNum=e.pageNum,n.pageSize=e.pageSize,I.value=e.total}catch{}},H=e=>{n.pageNum=1,n.pageSize=e,m()},K=e=>{n.pageNum=e,m()},B=r(),q=async e=>{!e||await e.validate((a,_)=>{a?(console.log("submit!"),O()):console.log("error submit!",_)})},O=async()=>{try{const e=v.value?await U(t):await se(t);p.value=!1,$.success("\u64CD\u4F5C\u6210\u529F"),m()}catch{}},Q=async e=>{v.value=!0,p.value=!0,t.roleId=e.roleId,t.roleName=e.roleName,t.roleDesc=e.roleDesc},S=()=>{t.roleId="",v.value=!1,p.value=!1,f.value=!1},E=r(null),F=r(""),G=async e=>{f.value=!0,w.value=e.roleName,t.roleId=e.roleId,t.roleName=e.roleName,t.roleDesc=e.roleDesc,await ve();const a=await Ee({roleId:e.roleId});F.value=a;let _=[];E.value.setCheckedNodes(De(a,_))},J=async()=>{try{const e=await Ce();V.value=e}catch{}},W=e=>{F.value=[...new Set([E.value.getCheckedKeys(),...E.value.getHalfCheckedKeys()])].join(",")},X=async()=>{try{const e=await U({moduleIds:F.value,roleId:t.roleId,roleName:t.roleName});$.success("\u64CD\u4F5C\u6210\u529F"),f.value=!1,m()}catch{}};de(()=>{J(),m()});const{maxTableHeight:Y,setTableMaxHeight:Be}=te({id:"userTable",offsetBottom:100});return(e,a)=>{const _=s("ElInput"),T=s("ElCol"),c=s("ElButton"),Z=s("ElRow"),b=s("ElTableColumn"),ee=s("ElTable"),le=s("ElPagination"),R=s("el-input"),A=s("ElFormItem"),ae=s("ElForm"),M=s("ElDialog"),N=ce("permission");return D(),ie("div",be,[l(Z,{class:"search-row"},{default:o(()=>[l(T,{span:6},{default:o(()=>[Ne,l(_,{modelValue:n.roleName,"onUpdate:modelValue":a[0]||(a[0]=u=>n.roleName=u),size:"default",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u5173\u952E\u8BCD\u641C\u7D22","prefix-icon":C(pe)},null,8,["modelValue","prefix-icon"])]),_:1}),l(T,{span:3},{default:o(()=>[l(c,{color:"#4371EE",size:"default",onClick:m},{default:o(()=>[d(" \u641C\u7D22 ")]),_:1})]),_:1}),h(' <ElCol :span="3"> '),y((D(),z(c,{class:"add-btn",color:"#4371EE",size:"default",onClick:a[1]||(a[1]=u=>p.value=!0),icon:C(me)},{default:o(()=>[d(" \u65B0\u589E\u89D2\u8272 ")]),_:1},8,["icon"])),[[N,"/addRole"]]),h(" </ElCol> ")]),_:1}),l(ee,{id:"userTable",class:"table",data:x.value,style:fe({height:`${C(Y)}px`,overflow:"auto"})},{default:o(()=>[l(b,{prop:"roleName",label:"\u89D2\u8272\u540D"}),l(b,{prop:"roleDesc",label:"\u5907\u6CE8"}),l(b,{prop:"address",fixed:"right",label:"\u64CD\u4F5C",width:"200"},{default:o(u=>[y((D(),z(c,{link:"",color:"#4371EE",size:"default",onClick:oe=>G(u.row)},{default:o(()=>[d(" \u6388\u6743 ")]),_:2},1032,["onClick"])),[[N,"/authorized"]]),y((D(),z(c,{link:"",color:"#4371EE",size:"default",onClick:oe=>Q(u.row)},{default:o(()=>[d(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])),[[N,"/editRole"]])]),_:1})]),_:1},8,["data","style"]),l(le,{class:"pagination",background:"",layout:"total,sizes,prev, pager, next,jumper",total:I.value,"current-page":n.pageNum,"page-sizes":[10,20,50,100],"page-size":n.pageSize,onSizeChange:H,onCurrentChange:K},null,8,["total","current-page","page-size"]),h("\u65B0\u589E\u6216\u7F16\u8F91\u89D2\u8272"),l(M,{class:"dialog",modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=u=>p.value=u),title:v.value?"\u7F16\u8F91":"\u65B0\u589E",width:"600px"},{default:o(()=>[i("div",ke,[l(ae,{ref_key:"formDataRef",ref:B,model:t,rules:j,"label-width":"120px","label-position":"top",class:"demo-ruleForm"},{default:o(()=>[l(A,{label:"\u89D2\u8272\u540D",prop:"roleName"},{default:o(()=>[l(R,{modelValue:t.roleName,"onUpdate:modelValue":a[2]||(a[2]=u=>t.roleName=u),size:"default",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",maxlength:"10"},null,8,["modelValue"])]),_:1}),l(A,{label:"\u5907\u6CE8"},{default:o(()=>[l(R,{modelValue:t.roleDesc,"onUpdate:modelValue":a[3]||(a[3]=u=>t.roleDesc=u),type:"textarea",size:"default",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),i("span",ye,[l(c,{size:"default",onClick:S},{default:o(()=>[d("\u53D6 \u6D88")]),_:1}),l(c,{color:"#4371EE",size:"default",onClick:a[4]||(a[4]=u=>q(B.value))},{default:o(()=>[d("\u4FDD\u5B58\u63D0\u4EA4")]),_:1})])]),_:1},8,["modelValue","title"]),h("\u6388\u6743"),l(M,{class:"dialog",modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=u=>f.value=u),title:"\u6388\u6743",width:"600px"},{default:o(()=>[i("div",ze,[i("p",xe,[d(" \u4E3A\u201C"),i("span",null,_e(w.value),1),d("\u201D\u6388\u4E88\u6743\u9650 ")]),Ie,l(C(ge),{ref_key:"tree",ref:E,data:V.value,props:P,"show-checkbox":"","node-key":"moduleId",onCheckChange:W},null,8,["data"])]),i("span",we,[l(c,{size:"default",onClick:S},{default:o(()=>[d("\u53D6 \u6D88")]),_:1}),l(c,{color:"#4371EE",size:"default",onClick:X},{default:o(()=>[d("\u4FDD\u5B58\u63D0\u4EA4")]),_:1})])]),_:1},8,["modelValue"])])}}});var Ae=ne(Ve,[["__scopeId","data-v-199f74cf"]]);export{Ae as default};
