import{_ as ge,d as me,a as m,b as U,N as we,g as d,h as P,i as j,j as F,k as t,w as o,l as z,I as ve,p as E,G as fe,H as _e,J as K,O as be,P as he,Q as Fe,t as T,A as O,L as ke,C as Ce,D as ye}from"./index.7d51010f.js";import"./dayjs.ff2b5191.js";const H=[[104.054352,30.58249],[104.055085,30.582357],[104.05601,30.582397],[104.056781,30.582397],[104.057822,30.582457],[104.058863,30.58249],[104.059827,30.58249],[104.060058,30.582125],[104.059981,30.580864],[104.060058,30.580731],[104.059981,30.580233],[104.06002,30.579801],[104.059981,30.579038],[104.06002,30.578773],[104.060482,30.578673],[104.060868,30.578738],[104.061178,30.578759],[104.06156,30.578749],[104.062026,30.578769],[104.062026,30.578769],[104.062312,30.578471],[104.062336,30.578327],[104.0623,30.578143],[104.062276,30.578009],[104.062336,30.577855],[104.062384,30.57766],[104.062324,30.5773],[104.062563,30.577249],[104.062837,30.577238],[104.063052,30.577228],[104.063314,30.577269],[104.063446,30.577279],[104.06384,30.577269]],De=()=>H,Ee=[{id:"1",label:"\u8F66\u961F1",children:[{id:"1-1",label:"\u5DDDA12345"},{id:"1-2",label:"\u5DDDB67890"},{id:"1-3",label:"\u5DDDC54321"}]},{id:"2",label:"\u8F66\u961F2",children:[{id:"2-1",label:"\u5DDDD98765"},{id:"2-2",label:"\u5DDDE43210"}]}],W=({list:_,page:k,pageSize:r})=>{const C=_.length,n=(k-1)*r,w=n+r;return{data:_.slice(n,w),total:C}},Me=[{id:1,timeRange:"10\u5206\u949F",beginTime:"2023-10-01 10:00",lng:104.060482,lat:"30.578673",endTime:"2023-10-01 10:10",location:"\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX"},{id:2,timeRange:"20\u5206\u949F",beginTime:"2023-10-01 10:10",lng:104.06384,lat:"30.577269",endTime:"2023-10-01 10:30",location:"\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX"}],G=(_=>_.map((k,r)=>({id:r+1,lng:k[0],lat:k[1],time:`2023-10-01 10:${String(r).padStart(2,"0")}`,speed:`${r+1} \u7C73/\u79D2`,location:`\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX ${r+1}`})))(H);const Pe=_=>(Ce("data-v-dc78492a"),_=_(),ye(),_),ze={class:"main-content"},Ae={class:"flex-box",id:"mapParentContainer",style:{height:"700px"}},xe={class:"left-box"},Se={class:"play-box"},Te={class:"map-layout"},Ie={class:"table-box"},Xe=Pe(()=>F("br",null,null,-1)),Be=me({__name:"list",setup(_){const k=(a=!1)=>{const e=new URL("./assets/moving.ff109e5a.png",self.location).href;return new AMap.Icon({image:e,size:new AMap.Size(21.75,49.5),imageSize:new AMap.Size(21.75,49.5)})},r=m(!1),C=m(null);U({});let n=[],w=null;const v=m(!1),s=U({beginDate:"",carNumber:"",endDate:""});m([]);const y=m(0),b=m(800),J=[{label:"x1",value:800},{label:"x5",value:400},{label:"x10",value:200},{label:"x20",value:100},{label:"x50",value:50}],I=m([]);(()=>{I.value=Ee})();const Q=({height:a})=>{const e=document.getElementById("mapParentContainer");e.style.height=a+"px"},q=a=>{w=a},Z=a=>{window.polyline&&window.polyline.setMap(null),window.passedPolyline&&window.passedPolyline.setMap(null),window.polyline=new AMap.Polyline({map:w,path:a,showDir:!0,strokeColor:"#28F",strokeWeight:6}),window.passedPolyline=new AMap.Polyline({map:w,strokeColor:"#AF5",strokeWeight:6}),window.marker=new AMap.Marker({map:w,position:a[0],icon:k(),offset:new AMap.Pixel(-13,-26)}),window.marker.on("moving",function(e){const u=A(a,e.target.getPosition()),i=u/a.length*100;y.value=i,console.log(i),r.value=u<a.length-1,window.passedPolyline.setPath(e.passedPath),w.setCenter(e.target.getPosition(),!0)}),w.setFitView()},ee=function(){window.marker.stopMove();const a=A(n,window.marker.getPosition());if(!n||n.length===0){O.error("\u8BF7\u5148\u67E5\u8BE2\u6709\u6548\u8F68\u8FF9\u6570\u636E");return}if(v.value)window.marker.resumeMove(),v.value=!1;else{const e=a<n.length-1?n.slice(a):n;window.marker.moveAlong(e,{duration:b.value,autoRotation:!0})}},ae=function(){v.value=!0,window.marker.pauseMove()},te=function(){window.marker.stopMove(),window.marker.setPosition(n[0]),y.value=0,r.value=!1,v.value=!1},X=()=>{window.marker&&window.marker.stopMove&&window.marker.stopMove(),window.polyline&&(window.polyline.setMap(null),window.polyline=null),window.passedPolyline&&(window.passedPolyline.setMap(null),window.passedPolyline=null),window.marker&&(window.marker.setMap(null),window.marker=null)},le=()=>{s.beginDate="",s.endDate="",s.carNumber="",X(),n=[],C.value&&C.value.setCurrentKey&&C.value.setCurrentKey(null)},ne=async()=>{const a={beginDate:s.beginDate,endDate:s.endDate||ke().format("YYYY-MM-DD"),carNumber:s.carNumber};try{n=await De(a),X(),Z(n)}catch{O.error("\u8F68\u8FF9\u6570\u636E\u67E5\u8BE2\u5931\u8D25")}c.value.page=1,p.value.page=1,x(),V()},oe=a=>{const e=!(a.children&&a.children.length);s.carNumber=e?a.label:""};we(b,a=>{});const ue=a=>{if(window.marker&&r.value&&!v.value){const e=window.marker.getPosition();console.log(e);const u=A(n,e);if(console.log(u),u!==-1&&u<n.length-1){const i=n.slice(u);window.marker.stopMove(),window.marker.setPosition(i[0]),window.marker.moveAlong(i,{duration:b.value,autoRotation:!0})}}},ie=a=>{if(console.log(a),!(!n||!n.length)&&window.marker){const e=Math.floor(y.value/100*n.length),u=n.slice(e);w.setCenter(u[0],!0),window.marker.setPosition(u[0]),r.value&&!v.value&&(window.marker.stopMove(),window.marker.setPosition(u[0]),window.marker.moveAlong(u,{duration:b.value,autoRotation:!0}))}},re=a=>{window.marker.stopMove()};function A(a,e){if(!Array.isArray(a)||a.length===0||!(e!=null&&e.lng)||!(e!=null&&e.lat))return 0;let u=1/0,i=0;for(let g=0;g<a.length;g++){const[h,D]=a[g],M=Math.abs(h-e.lng)+Math.abs(D-e.lat);M<u&&(u=M,i=g)}return i}const B=m([]),c=m({page:1,pageSize:10,total:0}),R=m([]),p=m({page:1,pageSize:10,total:0}),x=async()=>{({...s,page:c.value.page,pageSize:c.value.pageSize});const{data:a,total:e}=await W({page:c.value.page,pageSize:c.value.pageSize,list:Me});B.value=a,c.value.total=e},V=async()=>{console.log(G),{...s,page:p.value.page,pageSize:p.value.pageSize};const{data:a,total:e}=await W({page:p.value.page,pageSize:p.value.pageSize,list:G});R.value=a,p.value.total=e},N=(a,e)=>{a==="park"?(c.value.page=1,c.value.pageSize=e,x()):(p.value.page=1,p.value.pageSize=e)},Y=(a,e)=>{a==="park"?(c.value.page=e,x()):(p.value.page=e,V())},se=a=>{const{lat:e,lng:u}=a;if(window.marker){const i=n.findIndex(h=>h[0]===u&&h[1]===e),g=n.slice(i);w.setCenter(g[0],!0),window.marker.setPosition(g[0]),r.value&&!v.value&&(window.marker.stopMove(),window.marker.setPosition(g[0]),i<n.length-1?window.marker.moveAlong(g,{duration:b.value,autoRotation:!0}):(y.value=100,r.value=!1,v.value=!1))}};return(a,e)=>{const u=d("el-date-picker"),i=d("el-form-item"),g=d("el-button"),h=d("el-form"),D=d("el-card"),M=d("el-slider"),de=d("el-radio"),ce=d("el-radio-group"),S=d("el-icon"),pe=d("MyMap"),f=d("el-table-column"),L=d("el-table"),$=d("el-pagination");return P(),j("div",ze,[F("section",Ae,[F("section",xe,[t(D,{header:"\u6761\u4EF6\u67E5\u8BE2",class:"tree-card"},{default:o(()=>[t(h,{"label-position":"top",model:s},{default:o(()=>[t(i,{label:"\u5F00\u59CB\u65E5\u671F\uFF1A"},{default:o(()=>[t(u,{modelValue:s.beginDate,"onUpdate:modelValue":e[0]||(e[0]=l=>s.beginDate=l),type:"date",format:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F"},null,8,["modelValue"])]),_:1}),t(i,{label:"\u7ED3\u675F\u65E5\u671F\uFF1A"},{default:o(()=>[t(u,{modelValue:s.endDate,"onUpdate:modelValue":e[1]||(e[1]=l=>s.endDate=l),type:"date",format:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F"},null,8,["modelValue"])]),_:1}),t(i,{label:"\u9009\u62E9\u8F66\u8F86\uFF1A"},{default:o(()=>[t(z(ve),{ref_key:"treeRef",ref:C,"highlight-current":!0,"node-key":"id",data:I.value,onNodeClick:oe},null,8,["data"])]),_:1}),t(i,{style:{"text-align":"center"}},{default:o(()=>[t(g,{type:"primary",onClick:ne},{default:o(()=>[E("\u67E5 \u8BE2")]),_:1}),t(g,{onClick:le},{default:o(()=>[E("\u91CD \u7F6E")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{header:"\u8F68\u8FF9\u56DE\u653E",class:"bottom-card"},{default:o(()=>[t(h,null,{default:o(()=>[t(i,{label:"\u56DE\u653E\u8FDB\u5EA6\uFF1A"},{default:o(()=>[F("div",{onMousedown:re,style:{width:"100%"}},[t(M,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),"show-tooltip":!1,onChange:ie},null,8,["modelValue"])],32)]),_:1}),t(i,null,{default:o(()=>[t(ce,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),onChange:ue},{default:o(()=>[(P(),j(fe,null,_e(J,l=>t(de,{key:l.value,label:l.value},{default:o(()=>[E(T(l.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),F("section",Se,[!r.value||v.value?(P(),K(S,{key:0,onClick:e[4]||(e[4]=l=>ee())},{default:o(()=>[t(z(be))]),_:1})):(P(),K(S,{key:1,onClick:e[5]||(e[5]=l=>ae())},{default:o(()=>[t(z(he))]),_:1})),t(S,{class:"reset",onClick:e[6]||(e[6]=l=>te())},{default:o(()=>[t(z(Fe))]),_:1})])]),_:1})]),F("div",Te,[t(pe,{onInit:q,onResize:Q})])]),F("section",Ie,[t(D,{header:"\u505C\u9760\u4FE1\u606F"},{default:o(()=>[t(L,{border:"",id:"userTable",class:"table","scrollbar-always-on":!0,data:B.value},{default:o(()=>[t(f,{prop:"id",fixed:"",label:"id",width:"130"}),t(f,{prop:"timeRange",label:"\u505C\u9760\u65F6\u957F",width:"180"}),t(f,{prop:"beginTime",label:"\u5F00\u59CB\u65F6\u95F4",width:"180"}),t(f,{prop:"endTime",label:"\u7ED3\u675F\u65F6\u95F4",width:"180"}),t(f,{prop:"location",label:"\u4F4D\u7F6E\u63CF\u8FF0",width:"180"})]),_:1},8,["data"]),t($,{background:"",layout:"total,sizes,prev, pager, next,jumper",total:c.value.total,"current-page":c.value.page,"page-sizes":[10,20,50,100],"page-size":c.value.pageSize,onSizeChange:e[7]||(e[7]=l=>N("park",l)),onCurrentChange:e[8]||(e[8]=l=>Y("park",l))},null,8,["total","current-page","page-size"])]),_:1}),t(D,{header:"\u8F68\u8FF9\u4FE1\u606F"},{default:o(()=>[t(L,{border:"",id:"userTable",class:"table","scrollbar-always-on":!0,data:R.value,"highlight-current-row":!0,onRowClick:se},{default:o(()=>[t(f,{prop:"id",fixed:"",label:"id",width:"130"}),t(f,{prop:"time",label:"\u65F6\u95F4",width:"180"}),t(f,{prop:"speed",label:"\u901F\u5EA6",width:"180"}),t(f,{label:"\u7ECF\u7EAC\u5EA6",width:"180"},{default:o(l=>[E(" \u7ECF\u5EA6: "+T(l.row.lng),1),Xe,E(" \u7EAC\u5EA6: "+T(l.row.lat),1)]),_:1}),t(f,{prop:"location",label:"\u4F4D\u7F6E\u63CF\u8FF0",width:"400"})]),_:1},8,["data"]),t($,{background:"",layout:"total,sizes,prev, pager, next,jumper",total:p.value.total,"current-page":p.value.page,"page-sizes":[10,20,50,100],"page-size":p.value.pageSize,onSizeChange:e[9]||(e[9]=l=>N("location",l)),onCurrentChange:e[10]||(e[10]=l=>Y("location",l))},null,8,["total","current-page","page-size"])]),_:1})])])}}});var Ye=ge(Be,[["__scopeId","data-v-dc78492a"]]);export{Ye as default};
//# sourceMappingURL=list.183c5df5.js.map
