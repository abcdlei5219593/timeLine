import{a as E,o as R,F as rt,_ as it,d as dt,b as T,O as pt,g as F,h as L,i as S,k as n,w as u,p as i,s as y,j as A,l as w,T as ct,t as _,U as mt,V as U,W as ft,A as x,S as Et,X as gt,C as Ft,D as _t}from"./index.dd5a04bf.js";import{v as At}from"./index.bec933b6.js";import"./dayjs.e4ab635e.js";function j(l){return l&&l.offsetParent?j(l.offsetParent)+l.offsetTop:l.offsetTop}function O(l,m=120){const g=document.body.offsetHeight,s=j(document.getElementById(l));return g-s-m}function Pt({id:l="xc-table",offsetBottom:m=100}={}){const g=E(0),s=()=>{g.value=O(l,m)};return R(async()=>{setTimeout(s,200),window.addEventListener("resize",s)}),rt(()=>{window.removeEventListener("resize",s)}),{maxTableHeight:g,setTableMaxHeight:O}}const N=[{id:1,name:"\u4EFB\u52A11",startAddress:"\u8D77\u70B91",endAddress:"\u7EC8\u70B91",startPointLng:104.065735,endPointLng:104.065735,startPointLat:30.659462,endPointLat:30.659462},{id:2,name:"\u4EFB\u52A12",startAddress:"\u8D77\u70B92",endAddress:"\u7EC8\u70B92",startPointLng:104.066735,endPointLng:104.066735,startPointLat:30.660462,endPointLat:30.660462},{id:3,name:"\u4EFB\u52A13",startAddress:"\u8D77\u70B93",endAddress:"\u7EC8\u70B93",startPointLng:104.067735,endPointLng:104.067735,startPointLat:30.661462,endPointLat:30.661462}],Bt=()=>N.map((l,m)=>({id:l.id,name:l.name,startAddress:l.startAddress,endAddress:l.endAddress,startPoint:l.startPointLng+","+l.startPointLat,endPoint:l.endPointLng+","+l.endPointLat,startTime:new Date().toISOString(),endTime:new Date().toISOString(),type:"type"+m%3,amount:Math.floor(Math.random()*1e3),unit:"\u4EF6",freight:Math.floor(Math.random()*500),status:m%2===0?"\u8FDB\u884C\u4E2D":"\u5DF2\u5B8C\u6210"})),Ct=({list:l,page:m,pageSize:g})=>{let s=Bt();const r=s.length,b=(m-1)*g,f=b+g;return{data:s.slice(b,f),total:r}};const q=l=>(Ft("data-v-37634d00"),l=l(),_t(),l),vt={class:"main-content"},bt={class:"btns"},Dt=q(()=>A("br",null,null,-1)),ht=q(()=>A("br",null,null,-1)),yt={class:"dialog-form"},wt={key:0},xt={key:0},kt={class:"dialog-footer"},Mt={class:"dialog-form"},Vt={class:"dialog-footer"},Tt=dt({__name:"index",setup(l){E();const m=E([]),g=E(null);E({});let s=null,r=null;const b=E(null);let f=[];const z=e=>{s=e},K=()=>{s.on("click",e=>{const t=[e.lnglat.lng,e.lnglat.lat];r?r.setPosition(t):r=new AMap.Marker({position:t,map:s,draggable:!0}),f=[e.lnglat.lng,e.lnglat.lat]}),r&&r.on("dragend",()=>{const e=r.getPosition();f=[e.lng,e.lat]})},G=e=>{var v;const{location:t,name:P,address:c}=e;console.log("\u83B7\u53D6\u5230\u7684\u4F4D\u7F6E\u4FE1\u606F:",t);const d=[t.lng,t.lat];(v=b.value)==null||v.clearInput(),r?(r.setPosition(t),s.setCenter(t,!0)):r=new AMap.Marker({position:t,map:s,draggable:!0}),f=d},W=()=>{s&&(r&&(s.remove(r),r=null),f=[],s.off("click"),r&&r.off("dragend"))},X=()=>{if(!f||!f.length){x.error("\u8BF7\u5148\u5728\u5730\u56FE\u4E0A\u9009\u62E9\u4F4D\u7F6E");return}const e=k.value==="startPoint"?"startPosition":"endPosition";a[e]=f,a[k.value]=f.join(","),h.value=!1},k=E(null),I=async e=>{W(),k.value=e;const t=e==="startPoint"?a.startPosition:a.endPosition;if(h.value=!0,await Et(),!s){x.error("\u5730\u56FE\u52A0\u8F7D\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01");return}a[e]&&(s.setCenter(t,!0),r=new AMap.Marker({position:t,map:s,draggable:!0}),f=t,s.setFitView()),K()},p=T({name:"",page:1,pageSize:10}),J=E(0),Q=T({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D",trigger:"blur"}],startPoint:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D77\u70B9\u5750\u6807",trigger:"change"}],endPoint:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EC8\u70B9\u5750\u6807",trigger:"blur"}]}),D=async()=>{try{const e={...p,list:N},{data:t,total:P}=await Ct(e);m.value=t.map(c=>{const d=c.startPoint.split(","),v=c.endPoint.split(",");return{...c,startPosition:d,endPosition:v}}),P.value=P}catch{}},Y=async e=>{await gt.confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E  \u5B9A",cancelButtonText:"\u53D6  \u6D88",type:"warning"}),x.success("\u5220\u9664\u6210\u529F\uFF01"),M()},M=e=>{e&&g.value.resetFields(),p.page=1,D()},Z=e=>{p.page=1,p.pageSize=e,D()},tt=e=>{p.page=e,D()},C=E(!1),h=E(!1),V=E(null),a=T({id:null,name:null,startAddress:null,endAddress:null,startPoint:null,endPoint:null}),et=e=>{Object.keys(e).forEach(t=>a[t]=null)};pt(C,e=>{e||(V.value.clearValidate(),et(a))});const nt=async e=>{await At(e),a.id,a.name.trim(),a.startAddress.trim(),a.endAddress.trim(),a.startPoint,a.endPoint,x.success("\u63D0\u4EA4\u6210\u529F\uFF01"),C.value=!1,D()},at=async e=>{C.value=!0,Object.keys(e).forEach(t=>{t in a&&(a[t]=e[t])}),e.startPoint&&(a.startPosition=e.startPoint.split(",")),e.endPoint&&(a.endPosition=e.endPoint.split(","))};R(()=>{D()});const{maxTableHeight:ot,setTableMaxHeight:Lt}=Pt({id:"userTable",offsetBottom:92});return(e,t)=>{const P=F("el-input"),c=F("ElFormItem"),d=F("ElButton"),v=F("ElForm"),B=F("ElTableColumn"),ut=F("ElTable"),lt=F("ElPagination"),$=F("el-button"),H=F("ElDialog");return L(),S("div",vt,[n(v,{ref_key:"searchFormRef",ref:g,model:p,inline:"",class:"search-form","label-width":"68px","label-position":"left"},{default:u(()=>[n(c,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:u(()=>[n(P,{modelValue:p.name,"onUpdate:modelValue":t[0]||(t[0]=o=>p.name=o),placeholder:"\u8BF7\u8F93\u5165\u8F66\u724C\u53F7",clearable:""},null,8,["modelValue"])]),_:1}),n(c,null,{default:u(()=>[n(d,{color:"#4371EE",onClick:t[1]||(t[1]=o=>M(!1))},{default:u(()=>[i(" \u67E5\u8BE2 ")]),_:1}),n(d,{plain:"",onClick:t[2]||(t[2]=o=>M(!0))},{default:u(()=>[i(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1},8,["model"]),y(" </ElCol> "),A("div",bt,[n(d,{class:"add-btn",color:"#4371EE",icon:w(ct),onClick:t[3]||(t[3]=o=>C.value=!0)},{default:u(()=>[i(" \u6DFB\u52A0\u4EFB\u52A1 ")]),_:1},8,["icon"])]),n(ut,{border:"",id:"userTable",class:"table",data:m.value,style:mt({height:`${w(ot)}px`,overflow:"auto"})},{default:u(()=>[n(B,{label:"\u5E8F\u53F7",width:"80"},{default:u(o=>[i(_((p.page-1)*p.pageSize+o.$index+1),1)]),_:1}),n(B,{prop:"name",label:"\u4EFB\u52A1\u540D"}),n(B,{prop:"startAddress",label:"\u8D77\u70B9"}),n(B,{prop:"endAddress",label:"\u7EC8\u70B9"}),n(B,{label:"\u8D77\u70B9\u7ECF\u7EAC\u5EA6"},{default:u(o=>[A("span",null,[i(" \u7ECF\u5EA6:"+_(o.row.startPosition[0]),1),Dt,i(" \u7EAC\u5EA6:"+_(o.row.startPosition[1]),1)])]),_:1}),n(B,{prop:"endPointLat",label:"\u7EC8\u70B9\u7ECF\u7EAC\u5EA6"},{default:u(o=>[A("span",null,[i(" \u7ECF\u5EA6:"+_(o.row.endPosition[0]),1),ht,i(" \u7EAC\u5EA6:"+_(o.row.endPosition[1]),1)])]),_:1}),n(B,{prop:"startTime",label:"\u521B\u5EFA\u65F6\u95F4",width:"150"}),n(B,{fixed:"right",label:"\u64CD\u4F5C",width:"120"},{default:u(o=>[n(d,{link:"",type:"text",onClick:st=>at(o.row)},{default:u(()=>[i(" \u4FEE\u6539 ")]),_:2},1032,["onClick"]),n(d,{link:"",type:"text",onClick:st=>Y(o.row)},{default:u(()=>[i(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","style"]),n(lt,{class:"pagination",background:"",layout:"total,sizes,prev, pager, next,jumper",total:J.value,"current-page":p.page,"page-sizes":[10,20,50,100],"page-size":p.pageSize,onSizeChange:Z,onCurrentChange:tt},null,8,["total","current-page","page-size"]),y("\u65B0\u589E\u6216\u7F16\u8F91\u89D2\u8272"),n(H,{class:"main-dialog",modelValue:C.value,"onUpdate:modelValue":t[11]||(t[11]=o=>C.value=o),title:a.id?"\u4FEE\u6539\u4EFB\u52A1":"\u6DFB\u52A0\u4EFB\u52A1",width:"600px"},{footer:u(()=>[A("span",kt,[n(d,{onClick:t[9]||(t[9]=o=>C.value=!1)},{default:u(()=>[i("\u53D6 \u6D88")]),_:1}),n(d,{color:"#4371EE",onClick:t[10]||(t[10]=o=>nt(V.value))},{default:u(()=>[i("\u63D0 \u4EA4")]),_:1})])]),default:u(()=>[A("div",yt,[n(v,{ref_key:"addFormRef",ref:V,model:a,rules:Q,"label-width":"80px","label-position":"left"},{default:u(()=>[n(c,{label:"\u4EFB\u52A1\u540D",prop:"name",class:"full-item"},{default:u(()=>[n(P,{modelValue:a.name,"onUpdate:modelValue":t[4]||(t[4]=o=>a.name=o),placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),n(c,{label:"\u8D77\u70B9\u5750\u6807",prop:"startPoint",class:"full-item"},{default:u(()=>[a.startPoint?(L(),S("span",wt,"\u7ECF\u5EA6:"+_(a.startPosition[0])+"\uFF0C\u7EAC\u5EA6:"+_(a.startPosition[1]),1)):y("v-if",!0),n($,{onClick:t[5]||(t[5]=o=>I("startPoint")),type:"primary",plain:"",icon:w(U),style:{"margin-left":"10px"}},{default:u(()=>[i("\u5730\u56FE\u9009\u70B9")]),_:1},8,["icon"])]),_:1}),n(c,{label:"\u8D77\u70B9\u4F4D\u7F6E",prop:"startAddress",class:"full-item"},{default:u(()=>[n(P,{type:"textarea",modelValue:a.startAddress,"onUpdate:modelValue":t[6]||(t[6]=o=>a.startAddress=o),rows:2,placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),n(c,{label:"\u7EC8\u70B9\u5750\u6807",prop:"endPoint",class:"full-item"},{default:u(()=>[a.endPoint?(L(),S("span",xt,"\u7ECF\u5EA6:"+_(a.endPosition[0])+"\uFF0C\u7EAC\u5EA6:"+_(a.endPosition[1]),1)):y("v-if",!0),n($,{onClick:t[7]||(t[7]=o=>I("endPoint")),type:"primary",plain:"",icon:w(U),style:{"margin-left":"10px"}},{default:u(()=>[i("\u5730\u56FE\u9009\u70B9")]),_:1},8,["icon"])]),_:1}),n(c,{label:"\u7EC8\u70B9\u4F4D\u7F6E",prop:"endAddress",class:"full-item"},{default:u(()=>[n(P,{type:"textarea",modelValue:a.endAddress,"onUpdate:modelValue":t[8]||(t[8]=o=>a.endAddress=o),rows:2,placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"]),n(H,{class:"main-dialog",modelValue:h.value,"onUpdate:modelValue":t[13]||(t[13]=o=>h.value=o),title:"\u5730\u56FE\u9009\u70B9",width:"80%"},{footer:u(()=>[A("span",Vt,[n(d,{onClick:t[12]||(t[12]=o=>h.value=!1)},{default:u(()=>[i("\u53D6 \u6D88")]),_:1}),n(d,{color:"#4371EE",onClick:X},{default:u(()=>[i("\u786E \u5B9A")]),_:1})])]),default:u(()=>[A("div",Mt,[n(ft,{ref_key:"myMapRef",ref:b,autoComplete:!0,resize:!1,class:"my-map",onInit:z,onSelect:G},null,512)])]),_:1},8,["modelValue"])])}}});var $t=it(Tt,[["__scopeId","data-v-37634d00"]]);export{$t as default};
//# sourceMappingURL=index.1d613eef.js.map
