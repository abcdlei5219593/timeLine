import{_ as Pe,d as De,N as ze,a as d,b as ee,o as Se,O as xe,g as p,h as x,i as ae,j as A,k as l,w as i,l as I,I as Ie,p as D,G as Te,H as Be,J as le,P as Re,Q as Ve,R as Xe,t as $,S as Ne,A as T,L as Le,C as $e,D as Ye}from"./index.f8e22ed8.js";/* empty css                    */import"./dayjs.9ac3a968.js";const oe=[[104.054352,30.58249],[104.055085,30.582357],[104.05601,30.582397],[104.056781,30.582397],[104.057822,30.582457],[104.058863,30.58249],[104.059827,30.58249],[104.060058,30.582125],[104.059981,30.580864],[104.060058,30.580731],[104.059981,30.580233],[104.06002,30.579801],[104.059981,30.579038],[104.06002,30.578773],[104.060482,30.578673],[104.060868,30.578738],[104.061178,30.578759],[104.06156,30.578749],[104.062026,30.578769],[104.062026,30.578769],[104.062312,30.578471],[104.062336,30.578327],[104.0623,30.578143],[104.062276,30.578009],[104.062336,30.577855],[104.062384,30.57766],[104.062324,30.5773],[104.062563,30.577249],[104.062837,30.577238],[104.063052,30.577228],[104.063314,30.577269],[104.063446,30.577279],[104.06384,30.577269]],We=()=>oe,je=[{id:"1",label:"\u8F66\u961F1",children:[{id:"1-1",label:"\u5DDDA12345"},{id:"1-2",label:"\u5DDDB67890"},{id:"1-3",label:"\u5DDDC54321"}]},{id:"2",label:"\u8F66\u961F2",children:[{id:"2-1",label:"\u5DDDD98765"},{id:"2-2",label:"\u5DDDE43210"}]}],te=({list:h,page:P,pageSize:m})=>{const B=h.length,f=(P-1)*m,v=f+m;return{data:h.slice(f,v),total:B}},Ue=[{id:1,timeRange:"10\u5206\u949F",beginTime:"2023-10-01 10:00",lng:104.060482,lat:"30.578673",endTime:"2023-10-01 10:10",location:"\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX"},{id:2,timeRange:"20\u5206\u949F",beginTime:"2023-10-01 10:10",lng:104.06384,lat:"30.577269",endTime:"2023-10-01 10:30",location:"\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX"}],ne=(h=>h.map((P,m)=>({id:m+1,lng:P[0],lat:P[1],time:`2023-10-01 10:${String(m).padStart(2,"0")}`,speed:`${m+1} \u7C73/\u79D2`,location:`\u6210\u90FD\u6210\u534E\u5927\u9053XXXXXX ${m+1}`})))(oe);const Oe=h=>($e("data-v-055c9182"),h=h(),Ye(),h),Ke={class:"main-content"},qe={class:"flex-box",id:"mapParentContainer",style:{height:"750px"}},Ge={class:"left-box"},He={class:"play-box"},Je={class:"map-layout"},Qe={class:"table-box"},Ze=Oe(()=>A("br",null,null,-1)),ea=De({__name:"list",setup(h){const m=ze().query.vid,B=(a=!1)=>{const e=new URL("./assets/moving.ff109e5a.png",self.location).href;return new AMap.Icon({image:e,size:new AMap.Size(21.75,49.5),imageSize:new AMap.Size(21.75,49.5)})};let f=null;const v=d(!1),_=d(null);ee({});let o=[],c=null;const F=d(!1),s=ee({beginDate:"",carNumber:"",endDate:""});d([]);const k=d(0),C=d(800),ue=[{label:"x1",value:800},{label:"x5",value:400},{label:"x10",value:200},{label:"x20",value:100},{label:"x50",value:50}],Y=d([]),ie=async()=>{var a,e;Y.value=je,m&&(await Ne(),(a=_.value)==null||a.setCurrentKey(m),O((e=_.value)==null?void 0:e.getCurrentNode()))};Se(()=>{ie()});const se=({height:a})=>{const e=document.getElementById("mapParentContainer");e.style.height=a+"px"},re=a=>{c=a},W=d(null),j=d(null),de=a=>{if(window.polyline&&window.polyline.setMap(null),window.passedPolyline&&window.passedPolyline.setMap(null),window.polyline=new AMap.Polyline({map:c,path:a,showDir:!0,strokeColor:"#28F",strokeWeight:6}),a.length>0&&(W.value=new AMap.Circle({center:new AMap.LngLat(a[0][0],a[0][1]),radius:10,strokeColor:"#179117",strokeWeight:2,fillColor:"#179117",fillOpacity:1}),c.add(W.value)),a.length>1){const e=a[a.length-1];j.value=new AMap.Circle({center:new AMap.LngLat(e[0],e[1]),radius:10,strokeColor:"#E2231A",strokeWeight:2,fillColor:"#E2231A",fillOpacity:1}),c.add(j.value)}window.passedPolyline=new AMap.Polyline({map:c,strokeColor:"#AF5",strokeWeight:6}),window.marker=new AMap.Marker({map:c,position:a[0],icon:B(),offset:new AMap.Pixel(-13,-26)}),window.marker.on("moving",function(e){const t=R(a,e.target.getPosition()),u=t/a.length*100;k.value=u,console.log(u),v.value=t<a.length-1;const r=t+1<=e.passedPath.length?e.passedPath:[...a.slice(0,t+1),e.passedPath];window.passedPolyline.setPath(r),c.setCenter(e.target.getPosition(),!0)}),c.setFitView()},ce=function(){window.marker.stopMove();const a=R(o,window.marker.getPosition());if(!o||o.length===0){T.error("\u8BF7\u5148\u67E5\u8BE2\u6709\u6548\u8F68\u8FF9\u6570\u636E");return}if(F.value)window.marker.resumeMove(),F.value=!1;else{const e=a<o.length-1?o.slice(a):o;window.marker.moveAlong(e,{duration:C.value,autoRotation:!0})}},pe=function(){F.value=!0,window.marker.pauseMove()},ge=function(){window.marker.stopMove(),window.window.marker.setPosition(o[0]),window.passedPolyline&&window.passedPolyline.setPath(o.slice(0,1)),k.value=0,v.value=!1,F.value=!1,c.setCenter(o[0],!0)},U=()=>{window.marker&&window.marker.stopMove&&window.marker.stopMove(),window.polyline&&(window.polyline.setMap(null),window.polyline=null),window.passedPolyline&&(window.passedPolyline.setMap(null),window.passedPolyline=null),window.marker&&(window.marker.setMap(null),window.marker=null),M.value&&M.value.length&&(M.value.forEach(a=>{a.setMap(null)}),M.value=[]),f&&(f.close(),f=null)},we=()=>{s.beginDate="",s.endDate="",s.carNumber="",U(),o=[],_.value&&_.value.setCurrentKey&&_.value.setCurrentKey(null)},me=async()=>{if(!s.beginDate){T.error("\u8BF7\u9009\u62E9\u5F00\u59CB\u65E5\u671F");return}if(!s.carNumber){T.error("\u8BF7\u9009\u62E9\u8F66\u8F86");return}const a={beginDate:s.beginDate,endDate:s.endDate||Le().format("YYYY-MM-DD"),carNumber:s.carNumber};try{o=await We(a),U(),de(o)}catch{T.error("\u8F68\u8FF9\u6570\u636E\u67E5\u8BE2\u5931\u8D25")}g.value.page=1,w.value.page=1,X(),q()},O=a=>{const e=!(a.children&&a.children.length);s.carNumber=e?a.label:""};xe(C,a=>{});const fe=a=>{if(window.marker&&v.value&&!F.value){const e=window.marker.getPosition();console.log(e);const t=R(o,e);if(console.log(t),t!==-1&&t<o.length-1){const u=o.slice(t);window.marker.stopMove(),window.marker.setPosition(u[0]),window.marker.moveAlong(u,{duration:C.value,autoRotation:!0})}}},ve=a=>{if(console.log(a),!(!o||!o.length)&&window.marker){const e=Math.floor(k.value/100*o.length),t=o.slice(e);if(c.setCenter(t[0],!0),window.marker.setPosition(t[0]),window.passedPolyline.setPath(o.slice(0,e+1)),e>=o.length-1){k.value=100,v.value=!1,F.value=!1;return}v.value&&!F.value&&e<o.length-1&&(window.marker.stopMove(),window.marker.setPosition(t[0]),window.marker.moveAlong(t,{duration:C.value,autoRotation:!0}))}},Fe=a=>{window.marker.stopMove()};function R(a,e){if(!Array.isArray(a)||a.length===0||!(e!=null&&e.lng)||!(e!=null&&e.lat))return 0;let t=1/0,u=0;for(let r=0;r<a.length;r++){const[E,S]=a[r],y=Math.abs(E-e.lng)+Math.abs(S-e.lat);y<t&&(t=y,u=r)}return u}const V=d([]),g=d({page:1,pageSize:10,total:0}),K=d([]),w=d({page:1,pageSize:10,total:0}),X=async()=>{({...s,page:g.value.page,pageSize:g.value.pageSize});const{data:a,total:e}=await te({page:g.value.page,pageSize:g.value.pageSize,list:Ue});V.value=a,g.value.total=e,_e()},q=async()=>{console.log(ne),{...s,page:w.value.page,pageSize:w.value.pageSize};const{data:a,total:e}=await te({page:w.value.page,pageSize:w.value.pageSize,list:ne});K.value=a,w.value.total=e},G=(a,e)=>{a==="park"?(g.value.page=1,g.value.pageSize=e,X()):(w.value.page=1,w.value.pageSize=e)},H=(a,e)=>{a==="park"?(g.value.page=e,X()):(w.value.page=e,q())},be=a=>{const e=a.getExtData(),t=a.getPosition(),u=`
        <div class="info-window">
            <p><label>id\uFF1A</label>${e.id}</p>
            <p><label>\u505C\u9760\u65F6\u957F\uFF1A</label>${t.lng}, ${t.lat}</p>
            <p><label>\u5F00\u59CB\u65F6\u95F4</label>${e.beginTime||"\u65E0"}</p>
            <p><label>\u7ED3\u675F\u65F6\u95F4</label>${e.endTime||"\u65E0"}</p>
            <p><label>\u4F4D\u7F6E\u4FE1\u606F\uFF1A</label>${e.location||"\u65E0"}</p>

        </div>
    `;f=new AMap.InfoWindow({content:u,offset:new AMap.Pixel(0,-30)}),f.open(c,t)},M=d([]),N="https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",he="https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png",_e=()=>{V.value.forEach(a=>{const e=new AMap.Marker({map:c,icon:new AMap.Icon({image:N,size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34)}),extData:a,offset:new AMap.Pixel(-13,-30),position:[a.lng,a.lat]});e.on("click",()=>J(e)),M.value.push(e)})},z=d(null),J=a=>{const e=a.getExtData().id;M.value.forEach(t=>{const{id:u}=t.getExtData();if(console.log("marker id",u,a.id),u===e)if(console.log("\u5F53\u524D\u70B9\u51FB\u7684marker",t),z.value&&z.value.getExtData().id===u)f.close(),f=null,z.value=null,t.setIcon(new AMap.Icon({image:N,size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34)}));else{const r=t.getPosition();t.setIcon(new AMap.Icon({image:he,size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34)})),c.panTo(r,500),z.value=t,setTimeout(()=>{be(t)},500)}else t.setIcon(new AMap.Icon({image:N,size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34)}))})},ke=({id:a})=>{const e=M.value.find(t=>a===t.getExtData().id);console.log("\u70B9\u51FB\u4E86\u505C\u9760\u4FE1\u606F\u884C",e),e&&J(e)},Ce=a=>{const{lat:e,lng:t}=a;if(window.marker){const u=o.findIndex(E=>E[0]===t&&E[1]===e),r=o.slice(u);c.setCenter(r[0],!0),window.marker.setPosition(r[0]),window.passedPolyline.setPath(o.slice(0,u+1)),v.value&&!F.value&&(window.marker.stopMove(),window.marker.setPosition(r[0]),u<o.length-1?window.marker.moveAlong(r,{duration:C.value,autoRotation:!0}):(k.value=100,v.value=!1,F.value=!1))}};return(a,e)=>{const t=p("el-input"),u=p("el-form-item"),r=p("el-date-picker"),E=p("el-button"),S=p("el-form"),y=p("el-card"),Me=p("el-slider"),Ee=p("el-radio"),ye=p("el-radio-group"),L=p("el-icon"),Ae=p("MyMap"),b=p("el-table-column"),Q=p("el-table"),Z=p("el-pagination");return x(),ae("div",Ke,[A("section",qe,[A("section",Ge,[l(y,{header:"\u6761\u4EF6\u67E5\u8BE2",class:"tree-card"},{default:i(()=>[l(S,{"label-position":"top",model:s},{default:i(()=>[l(u,{label:"\u8F66\u724C\u53F7\uFF1A"},{default:i(()=>[l(t,{modelValue:s.carNumber,"onUpdate:modelValue":e[0]||(e[0]=n=>s.carNumber=n),placeholder:"\u8BF7\u8F93\u5165\u8F66\u724C\u53F7"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u5F00\u59CB\u65E5\u671F\uFF1A"},{default:i(()=>[l(r,{modelValue:s.beginDate,"onUpdate:modelValue":e[1]||(e[1]=n=>s.beginDate=n),type:"date",format:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u7ED3\u675F\u65E5\u671F\uFF1A"},{default:i(()=>[l(r,{modelValue:s.endDate,"onUpdate:modelValue":e[2]||(e[2]=n=>s.endDate=n),type:"date",format:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u9009\u62E9\u8F66\u8F86\uFF1A"},{default:i(()=>[l(I(Ie),{ref_key:"treeRef",ref:_,"highlight-current":!0,"node-key":"id",data:Y.value,onNodeClick:O},null,8,["data"])]),_:1}),l(u,{style:{"text-align":"center"}},{default:i(()=>[l(E,{type:"primary",onClick:me},{default:i(()=>[D("\u67E5 \u8BE2")]),_:1}),l(E,{onClick:we},{default:i(()=>[D("\u91CD \u7F6E")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(y,{header:"\u8F68\u8FF9\u56DE\u653E",class:"bottom-card"},{default:i(()=>[l(S,null,{default:i(()=>[l(u,{label:"\u56DE\u653E\u8FDB\u5EA6\uFF1A"},{default:i(()=>[A("div",{onMousedown:Fe,style:{width:"100%"}},[l(Me,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=n=>k.value=n),"show-tooltip":!1,onChange:ve},null,8,["modelValue"])],32)]),_:1}),l(u,null,{default:i(()=>[l(ye,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=n=>C.value=n),onChange:fe},{default:i(()=>[(x(),ae(Te,null,Be(ue,n=>l(Ee,{key:n.value,label:n.value},{default:i(()=>[D($(n.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),A("section",He,[!v.value||F.value?(x(),le(L,{key:0,onClick:e[5]||(e[5]=n=>ce())},{default:i(()=>[l(I(Re))]),_:1})):(x(),le(L,{key:1,onClick:e[6]||(e[6]=n=>pe())},{default:i(()=>[l(I(Ve))]),_:1})),l(L,{class:"reset",onClick:e[7]||(e[7]=n=>ge())},{default:i(()=>[l(I(Xe))]),_:1})])]),_:1})]),A("div",Je,[l(Ae,{onInit:re,onResize:se})])]),A("section",Qe,[l(y,{header:"\u505C\u9760\u4FE1\u606F"},{default:i(()=>[l(Q,{border:"",id:"userTable",class:"table","scrollbar-always-on":!0,data:V.value,onRowClick:ke},{default:i(()=>[l(b,{prop:"id",fixed:"",label:"id",width:"130"}),l(b,{prop:"timeRange",label:"\u505C\u9760\u65F6\u957F",width:"180"}),l(b,{prop:"beginTime",label:"\u5F00\u59CB\u65F6\u95F4",width:"180"}),l(b,{prop:"endTime",label:"\u7ED3\u675F\u65F6\u95F4",width:"180"}),l(b,{prop:"location",label:"\u4F4D\u7F6E\u63CF\u8FF0",width:"180"})]),_:1},8,["data"]),l(Z,{background:"",layout:"total,sizes,prev, pager, next,jumper",total:g.value.total,"current-page":g.value.page,"page-sizes":[10,20,50,100],"page-size":g.value.pageSize,onSizeChange:e[8]||(e[8]=n=>G("park",n)),onCurrentChange:e[9]||(e[9]=n=>H("park",n))},null,8,["total","current-page","page-size"])]),_:1}),l(y,{header:"\u8F68\u8FF9\u4FE1\u606F"},{default:i(()=>[l(Q,{border:"",id:"userTable",class:"table","scrollbar-always-on":!0,data:K.value,"highlight-current-row":!0,onRowClick:Ce},{default:i(()=>[l(b,{prop:"id",fixed:"",label:"id",width:"130"}),l(b,{prop:"time",label:"\u65F6\u95F4",width:"180"}),l(b,{prop:"speed",label:"\u901F\u5EA6",width:"180"}),l(b,{label:"\u7ECF\u7EAC\u5EA6",width:"180"},{default:i(n=>[D(" \u7ECF\u5EA6: "+$(n.row.lng),1),Ze,D(" \u7EAC\u5EA6: "+$(n.row.lat),1)]),_:1}),l(b,{prop:"location",label:"\u4F4D\u7F6E\u63CF\u8FF0",width:"400"})]),_:1},8,["data"]),l(Z,{background:"",layout:"total,sizes,prev, pager, next,jumper",total:w.value.total,"current-page":w.value.page,"page-sizes":[10,20,50,100],"page-size":w.value.pageSize,onSizeChange:e[10]||(e[10]=n=>G("location",n)),onCurrentChange:e[11]||(e[11]=n=>H("location",n))},null,8,["total","current-page","page-size"])]),_:1})])])}}});var na=Pe(ea,[["__scopeId","data-v-055c9182"]]);export{na as default};
//# sourceMappingURL=list.2215ebd2.js.map
